<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–î–æ–º–æ–≤–æ–π P2P ‚Ä¢ –í—ã–Ω–æ—Å –º—É—Å–æ—Ä–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Telegram WebApp (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Ç–≤–æ–µ–π –∫–Ω–æ–ø–∫–æ–π Open) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg:#0b1220;
      --panel:#121a2a;
      --border:#1f2a44;
      --muted:#9fb0d0;
      --text:#e7ecf5;
      --accent:#22c55e;
      --accent-2:#3b82f6;
      --danger:#ef4444;
      --warn:#f59e0b;
      --card:#0f172aee;
      --shadow:0 18px 40px rgba(13,20,35,.6);
      --radius:16px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:500 16px/1.45 system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial;
      display:flex; flex-direction:column;
    }

    .wrap{width:100%; max-width:980px; margin:0 auto; padding:16px 16px 24px}

    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:10px 0 14px; position:sticky; top:0; background:linear-gradient(180deg,var(--bg),transparent 92%);
      z-index:5;
    }
    .logo{font-weight:800; letter-spacing:.3px}
    .logo span{color:var(--accent)}
    .hint{font-size:12px; color:var(--muted)}

    .tabs{
      display:flex; gap:8px; border-bottom:1px solid var(--border); padding:6px 0 10px; margin-bottom:14px;
    }
    .tab{
      padding:7px 12px; font-size:14px; border-radius:999px;
      border:1px solid transparent; color:var(--muted); cursor:pointer; transition:.15s;
      background:transparent;
    }
    .tab.active{border-color:var(--border); color:var(--text); background:#0e1830}

    .toolbar{
      display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px
    }
    .select, .input{
      background:var(--panel); border:1px solid var(--border); color:var(--text);
      border-radius:12px; padding:10px 12px; font-size:14px;
    }
    .input{flex:1 1 180px}

    .section{display:none}
    .section.active{display:block}

    .list{
      display:flex; flex-direction:column; gap:12px; min-height:120px;
    }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:12px 12px;
    }
    .row{display:flex; justify-content:space-between; gap:12px; align-items:flex-start}
    .title{font-size:15px; font-weight:700}
    .price{font-weight:800}
    .muted{color:var(--muted); font-size:13px}
    .pill{
      font-size:12px; padding:4px 8px; border-radius:999px;
      border:1px solid var(--border); background:rgba(255,255,255,.03)
    }
    .pill.exec{color:#4ade80; border-color:#184d33; background:rgba(34,197,94,.08)}
    .pill.cust{color:#60a5fa; border-color:#1d3f71; background:rgba(59,130,246,.10)}

    .meta{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 6px}
    .meta .k{color:var(--muted); font-size:12px}

    .actions{display:flex; gap:8px; margin-top:8px}
    .btn{
      flex:0 0 auto; padding:10px 12px; font-size:14px; border-radius:12px;
      border:1px solid var(--border); background:transparent; color:var(--text); cursor:pointer
    }
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--accent); border-color:var(--accent); color:#04120a}
    .btn-ghost{opacity:.85}
    .btn-danger{background:var(--danger); border-color:var(--danger); color:#fff}
    .btn-block{width:100%}

    /* —Ñ–æ—Ä–º–∞ */
    .form{
      display:grid; gap:10px; grid-template-columns:1fr 1fr; background:var(--card);
      padding:14px; border:1px solid var(--border); border-radius:var(--radius)
    }
    .form h3{grid-column:1/-1; margin:4px 0 10px}
    .field{display:flex; flex-direction:column; gap:6px}
    .label{font-size:13px; color:var(--muted)}
    .form .input, .form .select{width:100%}
    .radio-line{grid-column:1/-1; display:flex; gap:8px}
    .radio{display:flex; gap:8px; align-items:center; background:var(--panel); border:1px solid var(--border); padding:8px 10px; border-radius:12px}
    .form .btn-primary{grid-column:1/-1; margin-top:6px}
    .form small{color:var(--muted); grid-column:1/-1}

    .empty{padding:14px; border:1px dashed var(--border); border-radius:12px; color:var(--muted); text-align:center}

    footer{margin-top:18px; color:var(--muted); font-size:12px; text-align:center}
    @media (max-width:640px){
      .form{grid-template-columns:1fr}
      .row{flex-direction:column; align-items:flex-start}
      .actions{width:100%}.actions .btn{flex:1 1 auto}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="logo">–î–æ–º–æ–≤–æ–π <span>P2P</span></div>
        <div class="hint">–í—ã–Ω–æ—Å –º—É—Å–æ—Ä–∞ ‚Ä¢ –æ–¥–∏–Ω –¥–æ–º ‚Äî –¥–≤–µ —Ä–æ–ª–∏: –∂–∏–ª—å—Ü—ã –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</div>
      </div>
      <div class="pill">–±–µ—Ç–∞</div>
    </header>

    <nav class="tabs">
      <button class="tab active" data-tab="feed">–õ–µ–Ω—Ç–∞</button>
      <button class="tab" data-tab="mine">–ú–æ–∏</button>
      <button class="tab" data-tab="create">–°–æ–∑–¥–∞—Ç—å</button>
    </nav>

    <!-- FEED -->
    <section id="feed" class="section active">
      <div class="toolbar">
        <select id="filterType" class="select">
          <option value="all">–¢–∏–ø: –≤—Å–µ</option>
          <option value="offer">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π</option>
          <option value="request">–ó–∞—è–≤–∫–∏ –∂–∏–ª—å—Ü–æ–≤</option>
        </select>
        <select id="filterEntrance" class="select">
          <option value="all">–ü–æ–¥—ä–µ–∑–¥: –ª—é–±–æ–π</option>
          <option value="1">1 –ø–æ–¥—ä–µ–∑–¥</option>
          <option value="2">2 –ø–æ–¥—ä–µ–∑–¥</option>
          <option value="3">3 –ø–æ–¥—ä–µ–∑–¥</option>
          <option value="4">4 –ø–æ–¥—ä–µ–∑–¥</option>
        </select>
        <input id="search" class="input" placeholder="–ü–æ–∏—Å–∫: –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –∫–≤., —ç—Ç–∞–∂..." />
      </div>

      <div id="feedList" class="list"></div>
      <div id="feedEmpty" class="empty" style="display:none">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –°–æ–∑–¥–∞–π—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ ¬´–°–æ–∑–¥–∞—Ç—å¬ª</div>
    </section>

    <!-- MY -->
    <section id="mine" class="section">
      <div class="list" id="myList"></div>
      <div class="empty" id="myEmpty" style="display:none">–£ –≤–∞—Å –µ—â—ë –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π.</div>
    </section>

    <!-- CREATE -->
    <section id="create" class="section">
      <form id="createForm" class="form">
        <h3>–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h3>

        <div class="radio-line">
          <label class="radio">
            <input type="radio" name="kind" value="offer" checked />
            –Ø –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å ‚Äî <b>–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</b> (—è –≤—ã–Ω–µ—Å—É, –Ω–∞–∑–Ω–∞—á–∞—é —Ü–µ–Ω—É)
          </label>
          <label class="radio">
            <input type="radio" name="kind" value="request" />
            –Ø –∂–∏–ª–µ—Ü ‚Äî <b>–∑–∞—è–≤–∫–∞</b> (–º–Ω–µ –≤—ã–Ω–µ—Å—Ç–∏, –ø—Ä–µ–¥–ª–∞–≥–∞—é —Ü–µ–Ω—É)
          </label>
        </div>

        <div class="field">
          <span class="label">–ü–æ–¥—ä–µ–∑–¥</span>
          <select name="entrance" class="select" required>
            <option value="1">1</option><option value="2">2</option>
            <option value="3">3</option><option value="4">4</option>
          </select>
        </div>

        <div class="field">
          <span class="label">–≠—Ç–∞–∂</span>
          <input name="floor" class="input" type="number" min="1" max="30" placeholder="–ù–∞–ø—Ä. 7" required/>
        </div>

        <div class="field">
          <span class="label">–ö–≤–∞—Ä—Ç–∏—Ä–∞</span>
          <input name="flat" class="input" type="number" min="1" max="999" placeholder="–ù–∞–ø—Ä. 64" required/>
        </div>

        <div class="field">
          <span class="label">–¶–µ–Ω–∞ (‚ÇΩ)</span>
          <input name="price" class="input" type="number" min="20" step="1" placeholder="–ù–∞–ø—Ä. 70" required/>
        </div>

        <div class="field">
          <span class="label">–ö–æ–≥–¥–∞ –≤—ã–Ω–µ—Å—Ç–∏</span>
          <input name="when" class="input" type="time" required/>
        </div>

        <div class="field">
          <span class="label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span>
          <input name="comment" class="input" placeholder="–ü–∞–∫–µ—Ç —É –¥–≤–µ—Ä–∏ / –ø–æ–∑–≤–æ–Ω–∏—Ç—å –≤ –¥–æ–º–æ—Ñ–æ–Ω..." />
        </div>

        <button class="btn btn-primary" type="submit">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        <small>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –æ–ø–ª–∞—Ç–∞ –ø–æ–∫–∞ —á–µ—Ä–µ–∑ —á–∞—Ç —Å –±–æ—Ç–æ–º. –í–µ–±-—ç–∫—à–µ–Ω—ã –ø–æ–¥–∫–ª—é—á–∏–º –ø–æ–∑–∂–µ.</small>
      </form>
    </section>

    <footer>–î–æ–º–æ–≤–æ–π P2P ¬∑ –ø—Ä–æ—Ç–æ—Ç–∏–ø. –í—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –æ–ø–ª–∞—Ç—ã.</footer>
  </div>

  <script>
    // ===== Telegram WebApp (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –ø—É—Å—Ç—å –±—É–¥–µ—Ç –∫—Ä–∞—Å–∏–≤–æ)
    try { window.Telegram?.WebApp?.expand?.(); } catch(e){}

    // ===== –î–ê–ù–ù–´–ï (–≤ —Ä–µ–∞–ª–µ —Ç—ã –ø–æ–¥—Å—Ç–∞–≤–∏—à—å —Å–≤–æ–∏ /api)
    const me = { id: Math.floor(Math.random()*1e9) }; // –ø—Å–µ–≤–¥–æ-—é–∑–µ—Ä –¥–ª—è "–ú–æ–∏"
    const items = [
      // type: 'offer' (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å), 'request' (–∂–∏–ª–µ—Ü)
      { id:1, type:'offer',  entrance:'1', floor:5, flat:27, price:70,  when:'20:00', comment:'–ó–∞–±–µ—Ä—É –∑–∞ 10 –º–∏–Ω—É—Ç', author:111 },
      { id:2, type:'request',entrance:'2', floor:12,flat:104,price:60,  when:'19:30', comment:'–ü–∞–∫–µ—Ç —É –¥–≤–µ—Ä–∏',     author:222 },
      { id:3, type:'offer',  entrance:'1', floor:7, flat:39, price:80,  when:'21:00', comment:'–õ–∏—Ñ—Ç –∏—Å–ø—Ä–∞–≤–µ–Ω',     author:333 },
      { id:4, type:'request',entrance:'3', floor:2, flat:14, price:40,  when:'18:15', comment:'–ü–æ–∑–≤–æ–Ω–∏—Ç–µ',         author:444 },
    ];
    let nextId = 5;

    // ===== –í–ö–õ–ê–î–ö–ò
    const tabs = document.querySelectorAll('.tab');
    const sections = document.querySelectorAll('.section');
    tabs.forEach(t=>{
      t.addEventListener('click', ()=>{
        tabs.forEach(x=>x.classList.remove('active'));
        sections.forEach(s=>s.classList.remove('active'));
        t.classList.add('active');
        document.getElementById(t.dataset.tab).classList.add('active');
        if (t.dataset.tab==='mine') renderMy();
        if (t.dataset.tab==='feed') renderFeed();
      });
    });

    // ===== –†–ï–ù–î–ï–† –ö–ê–†–¢–û–ß–ö–ò
    function renderCard(it){
      const el = document.createElement('div');
      el.className = 'card';

      const typePill = it.type==='offer' ? '<span class="pill exec">–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</span>'
                                         : '<span class="pill cust">–∑–∞—è–≤–∫–∞ –∂–∏–ª—å—Ü–∞</span>';

      el.innerHTML = `
        <div class="row">
          <div>
            <div class="title">–ü–æ–¥—ä–µ–∑–¥ ${it.entrance} ‚Ä¢ —ç—Ç–∞–∂ ${it.floor} ‚Ä¢ –∫–≤. ${it.flat}</div>
            <div class="meta">
              ${typePill}
              <span class="k">–≤—ã–Ω–µ—Å—Ç–∏ –∫&nbsp;${it.when}</span>
            </div>
            ${it.comment ? `<div class="muted">üí¨ ${escapeHtml(it.comment)}</div>` : ``}
          </div>
          <div class="price">${Number(it.price).toFixed(0)} ‚ÇΩ</div>
        </div>
        <div class="actions">
          ${
            it.author===me.id
              ? `<button class="btn btn-danger" data-act="del">–£–¥–∞–ª–∏—Ç—å</button>`
              : `<button class="btn btn-primary" data-act="take">–í–∑—è—Ç—å</button>
                 <button class="btn btn-ghost" data-act="more">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>`
          }
        </div>
      `;

      el.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const act = btn.dataset.act;
          if (act==='take') {
            alert('‚úÖ –ó–∞—è–≤–∫–∞/–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ –ø—Ä–∏–Ω—è—Ç–æ.\n(–î–∞–ª—å—à–µ ‚Äî —á–∞—Ç —Å –±–æ—Ç–æ–º –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.)');
          } else if (act==='more') {
            alert('‚ÑπÔ∏è –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ ‚Äî —ç–∫—Ä–∞–Ω —Å –¥–µ—Ç–∞–ª—è–º–∏ –∏ –≥–µ–æ/—á–∞—Ç–æ–º.');
          } else if (act==='del') {
            const idx = items.findIndex(x=>x.id===it.id);
            if (idx>-1) { items.splice(idx,1); renderFeed(); renderMy(); }
          }
        });
      });
      return el;
    }

    // ===== –õ–ï–ù–¢–ê
    const feedList = document.getElementById('feedList');
    const feedEmpty = document.getElementById('feedEmpty');
    const filterType = document.getElementById('filterType');
    const filterEntrance = document.getElementById('filterEntrance');
    const search = document.getElementById('search');

    [filterType, filterEntrance, search].forEach(el=>el.addEventListener('input', renderFeed));

    function renderFeed(){
      const t = filterType.value;          // all/offer/request
      const e = filterEntrance.value;      // all/1/2/3/4
      const q = search.value.toLowerCase();

      const arr = items.filter(it=>{
        if (t!=='all' && it.type!==t) return false;
        if (e!=='all' && it.entrance!==e) return false;
        const hay = `${it.comment||''} ${it.flat} ${it.floor}`.toLowerCase();
        if (q && !hay.includes(q)) return false;
        return true;
      });

      feedList.innerHTML = '';
      arr.forEach(it=>feedList.appendChild(renderCard(it)));
      feedEmpty.style.display = arr.length? 'none':'block';
    }

    // ===== –ú–û–ò
    const myList = document.getElementById('myList');
    const myEmpty = document.getElementById('myEmpty');
    function renderMy(){
      const arr = items.filter(it=>it.author===me.id);
      myList.innerHTML = '';
      arr.forEach(it=>myList.appendChild(renderCard(it)));
      myEmpty.style.display = arr.length? 'none':'block';
    }

    // ===== –°–û–ó–î–ê–ù–ò–ï
    const form = document.getElementById('createForm');
    form.addEventListener('submit', e=>{
      e.preventDefault();
      const fd = new FormData(form);
      const it = {
        id: nextId++,
        type: fd.get('kind'),                // offer | request
        entrance: fd.get('entrance'),
        floor: Number(fd.get('floor')),
        flat: Number(fd.get('flat')),
        price: Number(fd.get('price')),
        when: fd.get('when'),
        comment: fd.get('comment')?.trim(),
        author: me.id
      };
      items.unshift(it);
      form.reset();
      form.querySelector('input[name="kind"][value="offer"]').checked = true;
      alert('‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ.');
      // –ø–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –≤ "–ú–æ–∏"
      document.querySelector('.tab[data-tab="mine"]').click();
    });

    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}

    // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
    renderFeed();
  </script>
</body>
</html>
