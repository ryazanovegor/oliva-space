<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Oliva Space üåø ‚Äî –ø–∞–Ω–µ–ª—å –∑–∞–¥–∞—á</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #060711;
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: radial-gradient(circle at top left, #1ac46b 0, #060711 55%);
    }

    .logo {
      font-size: 20px;
      font-weight: 700;
    }

    .logo span {
      color: #1ac46b;
    }

    .tagline {
      font-size: 13px;
      opacity: 0.85;
    }

    main {
      flex: 1;
      padding: 20px 24px 32px;
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .card {
      background: rgba(13, 15, 30, 0.96);
      border-radius: 18px;
      padding: 14px 16px 16px;
      border: 1px solid rgba(255, 255, 255, 0.04);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.45);
    }

    .card h2 {
      font-size: 16px;
      margin-bottom: 6px;
    }

    .card small {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.65;
    }

    .tasks-list {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 360px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .task {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid rgba(255, 255, 255, 0.03);
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 2px 10px;
      align-items: center;
    }

    .task-title {
      font-size: 13px;
      font-weight: 500;
    }

    .task-meta {
      font-size: 11px;
      opacity: 0.7;
    }

    .task-status {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      justify-self: flex-end;
    }

    .status-new {
      background: rgba(52, 152, 219, 0.18);
      color: #74b9ff;
    }

    .status-progress {
      background: rgba(241, 196, 15, 0.16);
      color: #f1c40f;
    }

    .status-done {
      background: rgba(39, 174, 96, 0.2);
      color: #2ecc71;
    }

    .status-other {
      background: rgba(149, 165, 166, 0.25);
      color: #ecf0f1;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    footer {
      padding: 10px 24px 18px;
      font-size: 11px;
      opacity: 0.65;
      text-align: center;
    }

    .error {
      margin-top: 12px;
      font-size: 12px;
      color: #ff7675;
    }

    .empty {
      margin-top: 10px;
      font-size: 12px;
      opacity: 0.7;
    }
  </style>
</head>
<body>
<header>
  <div>
    <div class="logo">Oliva <span>Space</span></div>
    <div class="tagline">–ü–∞–Ω–µ–ª—å –∑–∞–¥–∞—á –¥–ª—è –º–∏–∫—Ä–æ-–±–∏—Ä–∂–∏ Telegram-–±–æ—Ç–∞</div>
  </div>
</header>

<main>
  <div class="card">
    <h2>–ó–∞–¥–∞—á–∏ –±–∏—Ä–∂–∏</h2>
    <small>–ü–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞‚Ä¶</small>

    <div id="error" class="error" style="display:none;"></div>
    <div id="tasks" class="tasks-list"></div>
    <div id="empty" class="empty" style="display:none;">
      –ü–æ–∫–∞ –∑–∞–¥–∞—á –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤—å –ø–µ—Ä–≤—É—é —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π <b>/newtask</b>.
    </div>
  </div>
</main>

<footer>
  –î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ç–æ–≥–æ –∂–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, —á—Ç–æ –∏ —É Telegram-–±–æ—Ç–∞. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏.
</footer>

<script>
  async function loadTasks() {
    const tasksContainer = document.getElementById('tasks');
    const errorEl = document.getElementById('error');
    const emptyEl = document.getElementById('empty');

    errorEl.style.display = 'none';
    emptyEl.style.display = 'none';
    tasksContainer.innerHTML = '';

    try {
      const res = await fetch('/api/tasks');
      if (!res.ok) {
        throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + res.status);
      }

      const tasks = await res.json(); // –æ–∂–∏–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –∑–∞–¥–∞—á

      if (!Array.isArray(tasks) || tasks.length === 0) {
        emptyEl.style.display = 'block';
        return;
      }

      tasks.forEach(task => {
        const wrapper = document.createElement('div');
        wrapper.className = 'task';

        const title = document.createElement('div');
        title.className = 'task-title';
        title.textContent = (task.title || task.text || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏').trim();

        const meta = document.createElement('div');
        meta.className = 'task-meta';

        const price = (task.price != null) ? task.price + ' ‚ÇΩ' : '–±–µ–∑ —Ü–µ–Ω—ã';
        const idText = task.id != null ? 'ID: ' + task.id : '';
        meta.textContent = [price, idText].filter(Boolean).join(' ‚Ä¢ ');

        const status = document.createElement('div');
        const st = (task.status || '').toLowerCase();
        status.className = 'task-status ' + (
          st === 'new' || st === 'open' ? 'status-new' :
          st === 'in_progress' || st === 'doing' || st === 'progress' ? 'status-progress' :
          st === 'done' || st === 'completed' ? 'status-done' : 'status-other'
        );
        status.textContent = task.status || 'unknown';

        wrapper.appendChild(title);
        wrapper.appendChild(status);
        wrapper.appendChild(meta);

        tasksContainer.appendChild(wrapper);
      });
    } catch (err) {
      console.error(err);
      errorEl.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞—á–∏: ' + err.message;
      errorEl.style.display = 'block';
    }
  }

  loadTasks();
</script>
</body>
</html>
